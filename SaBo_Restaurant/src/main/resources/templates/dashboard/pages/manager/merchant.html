<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SaBo Admin | Thông tin nhà hàng</title>

	<!-- Google Font: Source Sans Pro -->
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
	<!-- Font Awesome -->
	<link rel="stylesheet" th:href="@{/dist/bootstrap-4.5.2/css/bootstrap.min.css}" />
	<!-- Theme style -->
	<link rel="stylesheet" th:href="@{/css/adminlte.min.css}">
	<link rel="stylesheet" th:href="@{/dist/DataTables/DataTables-1.10.21/css/dataTables.bootstrap4.min.css}">
	<base href="/" />
</head>

<body class="hold-transition sidebar-mini">
	<div class="wrapper">
		<!-- Preloader -->
		<div class="preloader flex-column justify-content-center align-items-center">
			<img class="animation__shake" src="/dist/img/AdminLTELogo.png" alt="AdminLTELogo" height="60" width="60">
		</div>

		<!-- Navbar -->
		<nav class="main-header navbar navbar-expand navbar-white navbar-light">
			<!-- Left navbar links -->
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
				</li>
			</ul>

			<!-- Right navbar links -->
			<ul class="navbar-nav ml-auto">
				<!-- Messages Dropdown Menu -->
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-comments"></i>
						<span class="badge badge-danger navbar-badge">3</span>
					</a>
					<div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
						<a href="#" class="dropdown-item">
							<!-- Message Start -->
							<div class="media">
								<img src="/dist/img/user1-128x128.jpg" alt="User Avatar"
									class="img-size-50 mr-3 img-circle">
								<div class="media-body">
									<h3 class="dropdown-item-title">
										KrisHung
										<span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
									</h3>
									<p class="text-sm">Kiểm tra đơn hàng XYZ</p>
									<p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
								</div>
							</div>
							<!-- Message End -->
						</a>
						<div class="dropdown-divider"></div>
						<a href="#" class="dropdown-item">
							<!-- Message Start -->
							<div class="media">
								<img src="/dist/img/user8-128x128.jpg" alt="User Avatar"
									class="img-size-50 img-circle mr-3">
								<div class="media-body">
									<h3 class="dropdown-item-title">
										Danh
										<span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
									</h3>
									<p class="text-sm">Đơn hàng đã thanh toán</p>
									<p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
								</div>
							</div>
							<!-- Message End -->
						</a>
						<div class="dropdown-divider"></div>
						<a href="#" class="dropdown-item">
							<!-- Message Start -->
							<div class="media">
								<img src="/dist/img/user3-128x128.jpg" alt="User Avatar"
									class="img-size-50 img-circle mr-3">
								<div class="media-body">
									<h3 class="dropdown-item-title">
										Nhà Hàng
										<span class="float-right text-sm text-warning"><i
												class="fas fa-star"></i></span>
									</h3>
									<p class="text-sm">thay đỗi địa chỉ</p>
									<p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
								</div>
							</div>
							<!-- Message End -->
						</a>
						<div class="dropdown-divider"></div>
						<a href="#" class="dropdown-item dropdown-footer">Đánh dấu đã xem</a>
					</div>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-widget="fullscreen" href="#" role="button">
						<i class="fas fa-expand-arrows-alt"></i>
					</a>
				</li>
				<li class="nav-item">
					<form id="logoutForm" method="POST" th:action="@{/logout}">
						<input type="hidden" th:if="${_csrf}" name="${_csrf.parameterName}" value="${_csrf.token}" />
						<button type="submit" class="btn btn-primary">Đăng xuất</button>
					</form>
				</li>
			</ul>
		</nav>
		<!-- /.navbar -->

		<!-- Main Sidebar Container -->
		<aside class="main-sidebar sidebar-dark-primary elevation-4">
			<!-- Brand Logo -->
			<a href="/manager/index" class="brand-link">
				<img src="/dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
					style="opacity: .8">
				<span class="brand-text font-weight-light">Web Admin</span>
			</a>

			<!-- Sidebar -->
			<div class="sidebar">
				<!-- Sidebar user panel (optional) -->
				<div class="user-panel mt-3 pb-3 mb-3 d-flex">
					<div class="image">
						<img src="/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
					</div>
					<div class="info">
						<a style="cursor: pointer;" class="d-block" id="greeting"></a>
					</div>
				</div>

				<!-- Sidebar Menu -->
				<nav class="mt-2">
					<ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
						data-accordion="false">
						<!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
						<li class="nav-item">
							<a href="/manager/index" class="nav-link">
								<i class="nav-icon fas fa-tachometer-alt"></i>
								<p>
									Theo dõi đơn hàng
								</p>
							</a>
						</li>

						<li class="nav-item menu-open">
							<a style="cursor:pointer;" class="nav-link active">
								<i class="fas fa-users nav-icon"></i>
								<p>
									Quản lý tài khoản
									<i class="right fas fa-angle-left"></i>
								</p>
							</a>
							<ul class="nav nav-treeview">
								<li class="nav-item">
									<a href="/manager/customer" class="nav-link">
										<i class="fas fa-user nav-icon"></i>
										<p>Tài khoản khách hàng</p>
									</a>
								</li>
								<li class="nav-item">
									<a href="/manager/merchant" class="nav-link active">
										<i class="fas fa-utensils nav-icon"></i>
										<p>Tài khoản nhà hàng</p>
									</a>
								</li>
							</ul>
						</li>
						<li class="nav-item">
							<a style="cursor:pointer;" class="nav-link">
								<i class="fas fa-chart-bar nav-icon"></i>
								<p>
									Thống kê
									<i class="right fas fa-angle-left"></i>
								</p>
							</a>
							<ul class="nav nav-treeview">
								<li class="nav-item">
									<a href="/manager/stats" class="nav-link">
										<i class="fas fa-file-invoice nav-icon"></i>
										<p>Đơn đặt bàn</p>
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</nav>
				<!-- /.sidebar-menu -->
			</div>
			<!-- /.sidebar -->
		</aside>

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<section class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1>Chỉnh sửa thông tin</h1>
						</div>
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item"><a href="#">Home</a></li>
								<li class="breadcrumb-item active">Nhà Hàng</li>
							</ol>
						</div>
					</div>
				</div><!-- /.container-fluid -->
			</section>

			<!-- Main content -->
			<section class="content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
									<h3 class="card-title">Thông tin nhà hàng</h3>
								</div>
								<!-- /.card-header -->
								<div class="card-body">
									<table id="customer" class="table table-bordered table-striped" style="width: 100%">

									</table>
								</div>
							</div>
							<!-- /.card -->
						</div>
						<!-- /.col -->
					</div>
					<!-- /.row -->
				</div>
				<!-- /.container-fluid -->
			</section>

			<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->
		<footer class="main-footer">
			<strong>Copyright &copy; 2020-2021 <a href="https://www.facebook.com/dinhquochung.quochung">Kris
					Hung</a>.</strong>
			All rights reserved.
			<div class="float-right d-none d-sm-inline-block">
				<b>Version</b> 1.0.0
			</div>
		</footer>
		<!-- Control Sidebar -->
		<aside class="control-sidebar control-sidebar-dark">
			<!-- Control sidebar content goes here -->
		</aside>
		<!-- /.control-sidebar -->
	</div>
	<!-- ./wrapper -->

	<!-- jQuery -->
	<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
	<script th:src="@{/dist/bootstrap-4.5.2/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/webjars/momentjs/min/moment.min.js}"></script>
	<!-- AdminLTE App -->
	<script th:src="@{/js/adminlte.min.js}"></script>
	<script th:src="@{/dist/DataTables/DataTables-1.10.21/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/dist/DataTables/DataTables-1.10.21/js/dataTables.bootstrap4.min.js}"></script>
	<script th:src="@{/dist/DataTables/Buttons-1.6.3/js/dataTables.buttons.min.js}"></script>
	<script th:src="@{/dist/DataTables/Buttons-1.6.3/js/buttons.bootstrap4.min.js}"></script>
	<script th:src="@{/webjars/sweetalert2/dist/sweetalert2.all.min.js}"></script>
	<script th:src="@{/webjars/font-awesome/js/all.min.js}"></script>
	<!-- Page specific script -->
	<script>
		$(document).ready(function () {
			$.ajax({
				url: `/manager/user`,
				type: "POST",
				//data: data,
				contentType: "application/json",
				cache: false,
				headers: {
					"accept": "application/json",
					"Access-Control-Allow-Origin": "*"
				},
				processData: false,
				beforeSend: function (xhr, settings) {
					if (typeof CSRFToken === "string")
						xhr.setRequestHeader('X-CSRF-Token', CSRFToken);
				},
				success: function (data, statusText, jqXHR) {
					$("#greeting").text(`Quản lý ${data.firstName}`);

					$("#greeting").on("click", function () {
						Swal.fire({
							icon: 'info',
							title: 'Thông tin tài khoản',
							html: `<div class="card-body">
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="lastName">Họ</label>
                                            <input type="text" class="form-control-plaintext" readonly name="lastName" id="lastName" value="${data.lastName}"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="firstName">Tên</label>
                                            <input type="text" class="form-control-plaintext" readonly name="firstName" id="firstName" value="${data.firstName}"/>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="gender">Giới tính</label>
                                            <select name="gender" id="gender" class="form-control-plaintext" readonly>
                                                <option value="1" ${data.gender === 1 ? "selected" : ""}>Nam</option>
                                                <option value="0" ${data.gender === 0 ? "selected" : ""}>Nữ</option>
                                                <option value="2" ${data.gender === 2 ? "selected" : ""}>Khác</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="birthday">Ngày sinh</label>
                                            <input type="date" class="form-control-plaintext" readonly name="birthday" id="birthday" value="${data.birthday}">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="email">Email</label>
                                            <input type="email" class="form-control-plaintext" readonly name="email" id="email" value="${data.email}">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="phone">Số điện thoại</label>
                                            <input type="tel" class="form-control-plaintext" readonly name="phone" readonly id="phone" value="${data.phone}" placeholder="090xxxxxxx" pattern="^(0?)(3[2-9]|5[6|8|9]|7[0|6-9]|8[0-6|8|9]|9[0-4|6-9])[0-9]{7}$">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="address">Địa chỉ</label>
                                        <textarea class="form-control-plaintext" readonly name="address" id="address" rows="3">${data.address}</textarea>
                                    </div>
                                </div>`,
							showConfirmButton: false,
							showLoaderOnConfirm: true,
							showCancelButton: true,
							cancelButtonText: "Đóng",
							focusConfirm: false
						});
					});
				},
				statusCode: {
					401: function (response) {
						window.location.replace("/login?status=401");
					},
					404: function (response) {
						alert("Không tìm thấy quản lý");
					},
					500: function (response) {
						alert("Đã xảy ra sự cố. Xin vui lòng thử lại");
					}
				}
			});

			let table = $('#customer').DataTable({
				dom: "<'clearfix'<'float-left align-middle mr-4'l>B<'float-right align-middle'f>>tr<'clearfix'<'float-left'i><'float-right'p>>",
				buttons: [
					{
						name: "addBtn",
						className: 'btn-primary',
						titleAttr: function (api) {
							return "Thêm";
						},
						text: function (api) {
							return '<i class="fas fa-user-plus"></i> Thêm';
						},
						action: function (e, api, node, config) {
							restaurantRegister(api);
						},
						init: function (api, node, config) {
							$(node).removeClass('btn-secondary')
						}
					}
				],
				pagingType: "full_numbers",
				autoWidth: true,
				orderCellsTop: true,
				autoWidth: true,
				fixedColumns: true,
				language: datatablesLanguage("vi-VN"),
				order: [0, 'asc'],
				rowId: "id",
				columns: [{
					data: null,
					name: null,
					className: "text-center",
					title: "STT",
					render: function (data, type, row, meta) {
						return meta.row + 1;
					}
				}, {
					data: "restaurantName",
					name: "restaurantName",
					className: "text-center",
					title: "Nhà hàng",
					render: $.fn.dataTable.render.text()
				}, {
					data: "email",
					name: "email",
					className: "text-center",
					title: "Email",
					render: $.fn.dataTable.render.text()
				}, {
					data: "phone",
					name: "phone",
					className: "text-center",
					title: "Điện thoại",
					render: $.fn.dataTable.render.text()
				}, {
					data: "manager.username",
					name: "username",
					className: "text-center",
					title: "Tài khoản",
					render: $.fn.dataTable.render.text()
				}, {
					data: "manager.active",
					name: "active",
					className: "text-center",
					title: "Trạng thái",
					render: function (data, type, row, meta) {
						switch (data) {
							case true:
								return "Hoạt động"
							case false:
								return "Đóng băng"
							default:
								return "N/A"
						}
					}
				}, {
					data: null,
					name: null,
					className: "text-center",
					title: "Thao tác",
					render: function (data, type, row, meta) {
						return `<button class="btn btn-success"><i class="fas fa-edit"></i></button>`;
					}
				}],
				ajax: {
					url: `/manager/restaurantList`,
					type: "POST",
					contentType: "application/json",
					cache: false,
					dataSrc: '',
					headers: {
						"accept": "application/json",
						"Access-Control-Allow-Origin": "*"
					},
					beforeSend: function (xhr, settings) {
						if (typeof CSRFToken === "string")
							xhr.setRequestHeader('X-CSRF-Token', CSRFToken);
					}
				},
				rowCallback: function (row, data) {
					let api = this.api();

					$(row).find("td:last-child button:first-child").on("click", function () {
						restaurantUpdate(data, api);
					});

					//$(row).find("td:last-child button:last-child").on("click", function () {
					//freezeInfo(data, api);
					//});
				}
			});

			function restaurantRegister(api) {
				Swal.fire({
					icon: "info",
					title: 'Thêm món',
					html: `<div class="card-body">
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="username">Tài khoản</label>
                                            <input type="text" class="form-control" name="username" id="username" />
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="password">Mật khẩu</label>
                                            <input type="password" class="form-control" name="password" id="password" />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="restaurantName">Tên nhà hàng</label>
                                            <input type="text" class="form-control" name="restaurantName" id="restaurantName" />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="email">Email</label>
                                            <input type="email" class="form-control" name="email" id="email" />
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="phone">Số điện thoại</label>
                                            <input type="tel" class="form-control" name="phone" id="phone" placeholder="090xxxxxxx" pattern="^(0?)(3[2-9]|5[6|8|9]|7[0|6-9]|8[0-6|8|9]|9[0-4|6-9])[0-9]{7}$">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="openTime">Giờ mở cửa</label>
                                            <input type="time" class="form-control" name="openTime" id="openTime" />
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="closeTime">Giờ đóng cửa</label>
                                            <input type="time" class="form-control" name="closeTime" id="closeTime" />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="image">Hình</label>
                                            <input type="file" class="form-control" name="image" id="image" />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="address">Địa chỉ</label>
                                            <textarea class="form-control" name="address" id="address" rows="3"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="overview">Giới thiệu</label>
                                            <textarea class="form-control" name="overview" id="overview" rows="3"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="active">Trạng thái</label>
                                            <select class="form-control" id="active" name="active">
                                               <option value="true">Hoạt động</option>
                                               <option value="false">Đóng băng</option>
                                         </select>
                                        </div>
                                    </div>
                                </div>`,
					buttonsStyling: true,
					showConfirmButton: true,
					confirmButtonText: "Thêm",
					showLoaderOnConfirm: true,
					showCancelButton: true,
					cancelButtonText: "Hủy",
					focusConfirm: true,
					allowOutsideClick: () => !Swal.isLoading(),
					preConfirm: () => {
						const restaurantName = Swal.getPopup().querySelector('#restaurantName').value;
						const email = Swal.getPopup().querySelector('#email').value;
						const phone = Swal.getPopup().querySelector('#phone').value;
						const openTime = Swal.getPopup().querySelector('#openTime').value;
						const closeTime = Swal.getPopup().querySelector('#closeTime').value;
						const address = Swal.getPopup().querySelector('#address').value;
						const overview = Swal.getPopup().querySelector('#overview').value;
						const active = Swal.getPopup().querySelector('#active').value;
						const imageName = Swal.getPopup().querySelector('#image').files[0] ? Swal.getPopup().querySelector('#image').files[0].name : "";
						const image = Swal.getPopup().querySelector('#image').files[0];

						const username = Swal.getPopup().querySelector('#username').value;
						const password = Swal.getPopup().querySelector('#password').value;

						if (isEmptyOrSpaces(restaurantName)) {
							Swal.showValidationMessage(`Vui lòng nhập tên nhà hàng`);
							return;
						}

						if (isEmptyOrSpaces(email)) {
							Swal.showValidationMessage(`Vui lòng nhập địa chỉ email`);
							return;
						}

						if (isEmptyOrSpaces(phone)) {
							Swal.showValidationMessage(`Vui lòng nhập số điện thoại`);
							return;
						}

						if (isEmptyOrSpaces(openTime) || isEmptyOrSpaces(closeTime)) {
							Swal.showValidationMessage(`Vui lòng nhập giờ mở cửa/đóng cửa`);
							return;
						}

						if (isEmptyOrSpaces(imageName)) {
							Swal.showValidationMessage(`Vui lòng chọn hình`);
							return;
						}

						if (isEmptyOrSpaces(address)) {
							Swal.showValidationMessage(`Vui lòng nhập địa chỉ`);
							return;
						}

						const data = {
							"restaurantName": restaurantName,
							"email": email,
							"phone": phone,
							"address": address,
							"openTime": openTime,
							"closeTime": closeTime,
							"state": 1,
							"overview": overview,
							"logo": {
								"image": imageName
							},
							"manager": {
								"username": username,
								"password": password,
								"active": active,
								"role": {
									"id": 1
								}
							}
						};

						let formData = new FormData();

						formData.append("restaurant", JSON.stringify(data));
						formData.append("image", image);

						return $.ajax({
							url: "/manager/restaurantRegister",
							type: "POST",
							data: formData,
							enctype: 'multipart/form-data',
							processData: false,
							contentType: false,
							cache: false,
							headers: {
								"accept": "application/json",
								"Access-Control-Allow-Origin": "*"
							},
							processData: false,
							beforeSend: function (xhr, settings) {
								if (typeof CSRFToken === "string")
									xhr.setRequestHeader('X-CSRF-Token', CSRFToken);
							},
							success: function (data, statusText, jqXHR) {
								Swal.fire(
									'Thông báo',
									'Đã thêm nhà hàng thành công!',
									'success'
								).then(() => {
									api.ajax.reload(null, false);
								});
							},
							statusCode: {
								401: function (response) {
									window.location.replace("/login?status=401");
								},
								404: function (response) {
									Swal.showValidationMessage(
										`Xin lỗi, không tìm thấy đường dẫn này`
									)
								},
								500: function (response) {
									Swal.showValidationMessage(
										`Xin lỗi, đã xảy ra sự cố hệ thống`
									)
								}
							}
						}).catch(function () {
							return false;
						});
					}
				});
			}

			function restaurantUpdate(restaurant, api) {
				Swal.fire({
					icon: "info",
					title: 'Cập nhật thông tin nhà hàng',
					html: `<div class="card-body">
									<input type="hidden" id="restaurantId" name="restaurantId" value="${restaurant.id}"/>
									<input type="hidden" id="managerId" name="managerId" value="${restaurant.manager.id}"/>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="username">Tài khoản</label>
                                            <input type="text" class="form-control" name="username" id="username" value="${restaurant.manager.username}"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="password">Mật khẩu</label>
                                            <input type="password" class="form-control" name="password" id="password" />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="restaurantName">Tên nhà hàng</label>
                                            <input type="text" class="form-control" name="restaurantName" id="restaurantName" value="${restaurant.restaurantName}"/>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="email">Email</label>
                                            <input type="email" class="form-control" name="email" id="email" value="${restaurant.email}"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="phone">Số điện thoại</label>
                                            <input type="tel" class="form-control" name="phone" id="phone" value="${restaurant.phone}" placeholder="090xxxxxxx" pattern="^(0?)(3[2-9]|5[6|8|9]|7[0|6-9]|8[0-6|8|9]|9[0-4|6-9])[0-9]{7}$">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="openTime">Giờ mở cửa</label>
                                            <input type="time" class="form-control" name="openTime" id="openTime" value="${restaurant.openTime}"/>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="closeTime">Giờ đóng cửa</label>
                                            <input type="time" class="form-control" name="closeTime" id="closeTime" value="${restaurant.closeTime}"/>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="image">Hình</label>
                                            <input type="file" class="form-control" name="image" id="image" />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="address">Địa chỉ</label>
                                            <textarea class="form-control" name="address" id="address" rows="3">${restaurant.address}</textarea>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="overview">Giới thiệu</label>
                                            <textarea class="form-control" name="overview" id="overview" rows="3">${restaurant.overview}</textarea>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label for="active">Trạng thái</label>
                                            <select class="form-control" id="active" name="active">
                                               <option value="true" ${restaurant.active === true ? "selected" : ""}>Hoạt động</option>
                                               <option value="false" ${restaurant.active === false ? "selected" : ""}>Đóng băng</option>
                                         </select>
                                        </div>
                                    </div>
                                </div>`,
					buttonsStyling: false,
					customClass: {
						"confirmButton": "btn btn-success mr-1",
						"cancelButton": "btn btn-secondary"
					},
					showConfirmButton: true,
					confirmButtonText: "Cập nhật",
					showLoaderOnConfirm: true,
					showCancelButton: true,
					cancelButtonText: "Hủy",
					focusConfirm: true,
					allowOutsideClick: () => !Swal.isLoading(),
					preConfirm: () => {
						const restaurantId = Swal.getPopup().querySelector('#restaurantId').value;
						const restaurantName = Swal.getPopup().querySelector('#restaurantName').value;
						const email = Swal.getPopup().querySelector('#email').value;
						const phone = Swal.getPopup().querySelector('#phone').value;
						const openTime = Swal.getPopup().querySelector('#openTime').value;
						const closeTime = Swal.getPopup().querySelector('#closeTime').value;
						const address = Swal.getPopup().querySelector('#address').value;
						const overview = Swal.getPopup().querySelector('#overview').value;
						const active = Swal.getPopup().querySelector('#active').value;
						const imageName = Swal.getPopup().querySelector('#image').files[0] ? Swal.getPopup().querySelector('#image').files[0].name : "";
						const image = Swal.getPopup().querySelector('#image').files[0];

						const managerId = Swal.getPopup().querySelector('#managerId').value;
						const username = Swal.getPopup().querySelector('#username').value;
						const password = Swal.getPopup().querySelector('#password').value;

						if (isEmptyOrSpaces(restaurantId) || isEmptyOrSpaces(managerId)) {
							Swal.showValidationMessage(`Form không hợp lệ. Vui lòng thử lại`);
							return;
						}

						const data = {
							"id": restaurantId,
							"restaurantName": restaurantName,
							"email": email,
							"phone": phone,
							"address": address,
							"openTime": openTime,
							"closeTime": closeTime,
							"state": 1,
							"overview": overview,
							"logo": {
								"image": imageName
							},
							"manager": {
								"id": managerId,
								"username": username,
								"password": password,
								"active": active,
								"role": {
									"id": 1
								}
							}
						};

						let formData = new FormData();

						formData.append("restaurant", JSON.stringify(data));
						formData.append("image", image);

						return $.ajax({
							url: "/manager/restaurantUpdate",
							type: "PUT",
							data: formData,
							enctype: 'multipart/form-data',
							processData: false,
							contentType: false,
							cache: false,
							headers: {
								"accept": "application/json",
								"Access-Control-Allow-Origin": "*"
							},
							processData: false,
							beforeSend: function (xhr, settings) {
								if (typeof CSRFToken === "string")
									xhr.setRequestHeader('X-CSRF-Token', CSRFToken);
							},
							success: function (data, statusText, jqXHR) {
								Swal.fire(
									'Thông báo',
									'Đã cập nhật thông tin nhà hàng thành công!',
									'success'
								).then(() => {
									api.ajax.reload(null, false);
								});
							},
							statusCode: {
								401: function (response) {
									window.location.replace("/login?status=401");
								},
								404: function (response) {
									Swal.showValidationMessage(
										`Xin lỗi, không tìm thấy đường dẫn này`
									)
								},
								500: function (response) {
									Swal.showValidationMessage(
										`Xin lỗi, đã xảy ra sự cố hệ thống`
									)
								}
							}
						}).catch(function () {
							return false;
						});
					}
				});
			}

			function isEmptyOrSpaces(str) {
				return str === null || str.match(/^ *$/) !== null;
			}

			function datatablesLanguage(lang) {
				if (lang === "vi-VN") {
					return {
						decimal: ".",
						emptyTable: "Bảng hiện không có dữ liệu",
						info: "Hiển thị từ _START_ đến _END_ mục trong tổng số _TOTAL_ mục",
						infoEmpty: "Không có dữ liệu",
						infoFiltered: "(Đã lọc trong tổng số _MAX_ mục)",
						infoPostFix: "",
						thousands: ",",
						lengthMenu: "Hiện _MENU_ mục",
						loadingRecords: "Đang tải...",
						processing: "Đang xử lý...",
						search: "Tìm kiếm:",
						zeroRecords: "Không có kết quả mà bạn cần tìm",
						paginate: {
							first: "Đầu",
							last: "Cuối",
							next: "Tiếp",
							previous: "Trước"
						},
						aria: {
							sortAscending: ": Sắp xếp cột theo thứ tự tăng dần",
							sortDescending: ": Sắp xếp cột theo thứ tự giảm dần"
						},
						select: {
							rows: {
								_: "%d mục đã được chọn",
								0: "Chưa mục nào được chọn"
							}
						}
					};
				} else if (lang === "en-US") {
					return {
						decimal: "",
						emptyTable: "No data available in table",
						info: "Showing _START_ to _END_ of _TOTAL_ entries",
						infoEmpty: "Showing 0 to 0 of 0 entries",
						infoFiltered: "(filtered from _MAX_ total entries)",
						infoPostFix: "",
						thousands: ",",
						lengthMenu: "Show _MENU_ entries",
						loadingRecords: "Loading...",
						processing: "Processing...",
						search: "Search:",
						zeroRecords: "No matching records found",
						paginate: {
							first: "First",
							last: "Last",
							next: "Next",
							previous: "Previous"
						},
						aria: {
							sortAscending: ": activate to sort column ascending",
							sortDescending: ": activate to sort column descending"
						},
						select: {
							rows: {
								_: "%d entries selected",
								0: "No entry selected",
								1: "1 entry selected"
							}
						}
					};
				} else {
					return {};
				}
			}
		});
	</script>
</body>

</html>